---
import Layout from "../layouts/Layout.astro";
import GlassCard from "../components/GlassCard.astro";

if (Astro.locals.user) {
	return Astro.redirect("/admin");
}
---

<Layout title="Login - Glass Cloud Journal">
	<main class="flex items-center justify-center min-h-screen p-4">
		<GlassCard className="w-full max-w-md p-6 sm:p-8 space-y-6">
			<div class="text-center space-y-2">
				<h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
					System Access
				</h1>
				<p class="text-gray-400">Enter your credentials to continue.</p>
			</div>

			<form id="login-form" class="space-y-4" action="/api/login" method="POST">
				<div class="space-y-2">
					<label for="username" class="text-sm font-medium text-gray-300">Username</label>
					<input
						type="text"
						id="username"
						name="username"
						required
						class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-white placeholder-gray-500 transition-all"
						placeholder="admin"
					/>
				</div>
				<div class="space-y-2">
					<label for="password" class="text-sm font-medium text-gray-300">Password</label>
					<input
						type="password"
						id="password"
						name="password"
						required
						class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-white placeholder-gray-500 transition-all"
						placeholder="••••••••"
					/>
				</div>

				<p id="error-message" class="text-red-400 text-sm text-center hidden"></p>

				<button
					type="submit"
					class="w-full py-2.5 px-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-semibold rounded-lg shadow-lg shadow-blue-500/20 transition-all hover:scale-[1.02] active:scale-[0.98]"
				>
					Authenticate
				</button>
			</form>
		</GlassCard>
	</main>
</Layout>

<script>
	const form = document.getElementById("login-form") as HTMLFormElement;
	const errorMessage = document.getElementById("error-message") as HTMLParagraphElement;

	form.addEventListener("submit", async (e) => {
		e.preventDefault();
		errorMessage.classList.add("hidden");
		errorMessage.innerText = "";

		const formData = new FormData(form);
		const response = await fetch("/api/login", {
			method: "POST",
			body: formData,
		});

		if (response.ok) {
			window.location.href = "/admin";
		} else {
			const data = await response.json();
			errorMessage.innerText = data.error || "Authentication failed";
			errorMessage.classList.remove("hidden");
		}
	});
</script>
