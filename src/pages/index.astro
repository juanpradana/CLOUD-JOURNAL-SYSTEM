---
import Layout from "../layouts/Layout.astro";
import { MotionGlassCard } from "../components/MotionGlassCard";
import AdSlot from "../components/AdSlot.astro";
import fs from "node:fs/promises";
import path from "node:path";

// Fetch articles
const contentDir = path.join(process.cwd(), "src/content/jurnal");
let articles = [];

try {
    // Check if directory exists first
    try {
        await fs.access(contentDir);
    } catch {
        await fs.mkdir(contentDir, { recursive: true });
    }

    const files = await fs.readdir(contentDir);
    articles = await Promise.all(
        files
            .filter(f => f.endsWith('.md'))
            .map(async (f) => {
                const content = await fs.readFile(path.join(contentDir, f), 'utf-8');
                const titleMatch = content.match(/title:\s*(.*)/);
                const dateMatch = content.match(/date:\s*(.*)/);
                const slugMatch = content.match(/slug:\s*(.*)/);
                const descMatch = content.match(/description:\s*(.*)/);
                
                return {
                    title: titleMatch ? titleMatch[1].trim() : f,
                    date: dateMatch ? new Date(dateMatch[1].trim()) : new Date(),
                    slug: slugMatch ? slugMatch[1].trim() : f.replace('.md', ''),
                    description: descMatch ? descMatch[1].trim() : "No description available.",
                };
            })
    );
    // Sort by date desc
    articles.sort((a, b) => b.date.getTime() - a.date.getTime());
} catch (e) {
    console.error("Error reading articles", e);
}
---

<Layout title="Glass Cloud Journal - Future of Documentation">
	<!-- Hero Section -->
	<section class="relative min-h-[55vh] sm:min-h-[60vh] flex items-center justify-center overflow-hidden">
		<!-- Animated Background Elements -->
		<div class="absolute top-1/4 left-1/4 w-72 h-72 sm:w-96 sm:h-96 bg-blue-600/20 rounded-full blur-[90px] sm:blur-[100px] animate-pulse"></div>
		<div class="absolute bottom-1/4 right-1/4 w-72 h-72 sm:w-96 sm:h-96 bg-purple-600/20 rounded-full blur-[90px] sm:blur-[100px] animate-pulse delay-1000"></div>

		<div class="relative z-10 text-center px-4 max-w-4xl mx-auto space-y-5 sm:space-y-6">
			<h1 class="text-4xl sm:text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 animate-gradient bg-300%">
				Glass Cloud Journal
			</h1>
			<p class="text-base sm:text-lg md:text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed">
				Explore the boundaries of technology and design in a crystal-clear digital expanse.
			</p>
			<div class="pt-6 sm:pt-8">
				<a href="#journal" class="px-6 sm:px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full backdrop-blur-md transition-all hover:scale-105 active:scale-95 inline-flex justify-center">
					Start Reading
				</a>
			</div>
		</div>
	</section>

	<AdSlot className="max-w-4xl mx-auto" />

	<!-- Journal Grid -->
	<section id="journal" class="max-w-7xl mx-auto px-4 py-12 sm:py-20">
		<h2 class="text-2xl sm:text-3xl font-bold mb-8 sm:mb-12 text-center text-white/90">Recent Transmissions</h2>
		
		<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8">
            {articles.length === 0 && (
                <div class="col-span-full text-center py-20 text-gray-500">
                    <p>No transmissions received yet.</p>
                </div>
            )}
			{articles.map((article, index) => (
				<a href={`/journal/${article.slug}`} class="group block h-full">
					<MotionGlassCard client:load delay={index * 0.1} className="h-full hover:bg-white/10 transition-colors duration-300 border-white/5 hover:border-blue-500/30">
						<div class="space-y-4">
							<div class="flex items-center justify-between text-xs text-blue-400 font-mono">
								<span>{article.date.toLocaleDateString()}</span>
								<span>LOG_ENTRY</span>
							</div>
							<h3 class="text-xl sm:text-2xl font-bold text-white group-hover:text-blue-300 transition-colors">
								{article.title}
							</h3>
							<p class="text-gray-400 line-clamp-3 leading-relaxed">
								{article.description}
							</p>
							<div class="pt-4 flex items-center text-sm text-blue-400 font-medium">
								Read Entry 
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 group-hover:translate-x-1 transition-transform"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
							</div>
						</div>
					</MotionGlassCard>
				</a>
			))}
		</div>
	</section>

    <footer class="border-t border-white/10 py-12 mt-20 bg-black/20 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p>&copy; {new Date().getFullYear()} Glass Cloud Journal System. All rights reserved.</p>
        </div>
    </footer>
</Layout>

<style>
	.animate-gradient {
		animation: gradient 8s linear infinite;
	}
	@keyframes gradient {
		0% { background-position: 0% 50%; }
		50% { background-position: 100% 50%; }
		100% { background-position: 0% 50%; }
	}
</style>
